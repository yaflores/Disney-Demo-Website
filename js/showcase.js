const shows = [
    {
        title: "Andor",
        slug: "andor",
        backgroundPosition : {
            x: 70.83,
            y: 40.74
        },
        excerpt: "In an era filled with danger, deception and intrigue, Cassian Andor will discover the difference he can make in the struggle against the tyrannical Galactic Empire. He embarks on a path that is destined to turn him into a rebel hero.",
        seasons: [
            {
                title: "Season 1",
                slug: "season-1",
                excerpt: "This is the description of what happens in season 1.",
                episodes : [
                    {
                        title: "Kassa",
                        excerpt: "Cassian Andor’s reckless search for answers about his past makes him a wanted man.",
                        duration: 42
                    },
                    {
                        title: "That Would Be Me",
                        excerpt: "Cassian attempts to lay low on Ferrix as agents of the law close in.",
                        duration: 38
                    },
                    {
                        title: "Reckoning",
                        excerpt: "Cassian’s desperation to avoid arrest leads him to a mysterious man with unknown connections.",
                        duration: 43
                    },
                    {
                        title: "Aldhani",
                        excerpt: "Out of options, Cassian is recruited for a dangerous mission to infiltrate an Imperial garrison.",
                        duration: 50
                    },
                    {
                        title: "The Axe Forgets",
                        excerpt: "Cassian must carefully navigate the distrust inherent in being the new member of a secret operation.",
                        duration: 46
                    },
                    {
                        title: "The Eye",
                        excerpt: "With cover from a spectacular local festival, the Aldhani mission reaches a point of no return.",
                        duration: 54
                    },
                    {
                        title: "Announcement",
                        excerpt: "The repercussions of the Aldhani heist reach all the way to Coruscant, while Cassian returns home.",
                        duration: 53
                    },
                    {
                        title: "Narkina 5",
                        excerpt: "The Empire catches up to Cassian, but are as yet unaware of his identity and past.",
                        duration: 57
                    },
                    {
                        title: "Nobody's Listening!",
                        excerpt: "Under intense scrutiny while imprisoned, Cassian makes allies to plan an impossible escape.",
                        duration: 50
                    },
                    {
                        title: "One Way Out",
                        excerpt: "A rare opportunity opens and the time for Cassian and his fellow inmates to act is now.",
                        duration: 50
                    },
                    {
                        title: "Daughter of Ferrix",
                        excerpt: "A fugitive once more, Cassian must make his next move before it is too late.",
                        duration: 46
                    },
                    {
                        title: "Rix Road",
                        excerpt: "Cassian returns home to Ferrix, a tinderbox that is experiencing a spark of rebellion.",
                        duration: 57
                    }
                ]
            }
        ],
        trailer: "https://www.youtube.com/watch?v=cKOegEuCcfw"
    },
    {
        title: "The Mandalorian",
        slug: "mandalorian",
        backgroundPosition : {
            x: 69.44,
            y: 41.9
        },
        excerpt: "After the fall of the Galactic Empire, a lone gunfighter makes his way through the outer reaches of the lawless galaxy.",
        seasons: [
            {
                title: "Season 1",
                slug: "season-1",
                excerpt: "This is the description of what happens in season 1 for The Mandalorian.",
                episodes : [
                    {
                        title: "Chapter 1: The Mandalorian",
                        excerpt: "A Mandalorian bounty hunter tracks a target for a well-paying, mysterious client.",
                        duration: 41
                    },
                    {
                        title: "Chapter 2: The Child",
                        excerpt: "Having tracked down a valuable quarry, the Mandalorian must now contend with thieving bandits.",
                        duration: 34
                    },
                    {
                        title: "Chapter 3: The Sin",
                        excerpt: "The battered Mandalorian returns to his client for reward, but some deals don’t end neatly.",
                        duration: 39
                    },
                    {
                        title: "Chapter 4: Sanctuary",
                        excerpt: "The Mandalorian teams up with an ex-soldier to protect a farming village from raiders.",
                        duration: 43
                    },
                    {
                        title: "Chapter 5: The Gunslinger",
                        excerpt: "On a familiar desert planet, the Mandalorian helps a rookie bounty hunter who is in over his head.",
                        duration: 37
                    },
                    {
                        title: "Chapter 6: The Prisoner",
                        excerpt: "The Mandalorian is part of a crew of mercenaries springing a convict from a prison ship.",
                        duration: 45
                    },
                    {
                        title: "Chapter 7: The Reckoning",
                        excerpt: "An old contact extends an invitation for the Mandalorian to make peace with his enemies.",
                        duration: 42
                    },
                    {
                        title: "Chapter 8: Redemption",
                        excerpt: "The Mandalorian and his allies come to know their true enemy, who already knows much about them.",
                        duration: 50
                    }
                ]
            },
            {
                title: "Season 2",
                slug: "season-2",
                excerpt: "This is the description of what happens in season 2 for The Mandalorian.",
                episodes : [
                    {
                        title: "Chapter 9: The Marshal",
                        excerpt: "The Mandalorian is drawn to the Outer Rim in search of others of his kind.",
                        duration: 56
                    },
                    {
                        title: "Chapter 10: The Passenger",
                        excerpt: "The Mandalorian must ferry a passenger with precious cargo on a risky journey.",
                        duration: 43
                    },
                    {
                        title: "Chapter 11: The Heiress",
                        excerpt: "The Mandalorian braves high seas and meets unexpected allies.",
                        duration: 37
                    },
                    {
                        title: "Chapter 12: The Siege",
                        excerpt: "TThe Mandalorian rejoins old allies for a new mission.",
                        duration: 41
                    },
                    {
                        title: "Chapter 13: The Jedi",
                        excerpt: "The Mandalorian journeys to a world ruled by a cruel magistrate who has made a powerful enemy.",
                        duration: 48
                    },
                    {
                        title: "Chapter 14: The Tragedy",
                        excerpt: "The Mandalorian and Child travel to an ancient site.",
                        duration: 35
                    },
                    {
                        title: "Chapter 15: The Believer",
                        excerpt: "To move against the Empire, the Mandalorian needs the help of an old enemy.",
                        duration: 43
                    },
                    {
                        title: "Chapter 16: The Rescue",
                        excerpt: "The Mandalorian and his allies attempt a daring rescue.",
                        duration: 48
                    }
                ]
            },
        ],
        trailer: "https://www.youtube.com/watch?v=aOC8E8z_ifw"
    },
    {
        title: "Toy Story",
        slug: "toy-story",
        backgroundPosition : {
            x: 66.666,
            y: 43.2
        },
        excerpt: "A cowboy doll is profoundly threatened and jealous when a new spaceman action figure supplants him as top toy in a boy's bedroom.",
        seasons: null,
        trailer: "https://www.youtube.com/watch?v=v-PjgYDrg70"
    }
];

// consts from showcase to closebtn
const sectionShowcase = document.getElementById("sectionShowcase");
const sectionEpisodes = document.getElementById("sectionEpisodes");

const overlayVideo = document.getElementById("overlayVideo");
const overlayCloseBtn = document.getElementById("overlayCloseBtn");
const overlayContainer = document.getElementById("overlayContainer");

overlayCloseBtn.addEventListener("click", () => {
    overlayVideo.classList.remove("active");
    overlayContainer.innerHTML = "";
}); // end of event listener 

const showcaseControls = document.createElement("ul");
showcaseControls.classList.add("showcase-controls");
sectionShowcase.appendChild(showcaseControls);

const bodyElement = document.querySelector("body");

shows.forEach((show, index)=> {
    // console.log(show.title);
    const showcaseItem = document.createElement("article");
    showcaseItem.classList.add("showcase-item");

    //bc image 
    showcaseItem.style.backgroundImage = `url(assets/${show.slug}/background.jpg)`;
    showcaseItem.style.backgroundPosition = `${show.backgroundPosition.x}%${show.backgroundPosition.y}%`;
    
    // content 
    const showcaseItemContent = document.createElement("div");
    showcaseItemContent.classList.add("showcase-item-content");

    // logo
    const showcaseItemLogo = document.createElement("img");
    showcaseItemLogo.src = `assets/${show.slug}/logo.png`;
    showcaseItemLogo.alt = `${show.title} logo`;
    showcaseItemLogo.classList.add("showcase-item-logo");

    // button for expand
    const btnExpand = document.createElement("button");
    btnExpand.classList.add("btn-ui-large","btn-expand");

    // "event name", callback function 
    btnExpand.addEventListener("click", ()=> {
        showcaseItem.classList.add("active");
        bodyElement.classList.add("showcase-active");
        clearInterval(timer);
        if (show.seasons) {
            handleSeasons(show.seasons, show.slug);
        }
    }); //end of event listener

    const btnExpandIcon = document.createElement("img");
    btnExpandIcon.src = "assets/icons/plus-black.svg";

    btnExpand.appendChild(btnExpandIcon);

    // button for collapse
    const btnCollapse = document.createElement("button");
    btnCollapse.classList.add("btn-ui-large", "btn-collapse");

    btnCollapse.addEventListener("click", ()=> {
        showcaseItem.classList.remove("active");
        bodyElement.classList.remove("showcase-active");
        sectionEpisodes.classList.remove("active");
        timer = setInterval(handleSlides, 5000);
    }); //end of event listener collapse button 
    const btnCollapseIcon = document.createElement("img");
    btnCollapseIcon.src = "assets/icons/close.svg";

    btnCollapse.appendChild(btnCollapseIcon);

    // button for play trailer
    const btnPlay = document.createElement("button");
    btnPlay.classList.add("btn","btn-play");
    btnPlay.innerText = "Play Trailer";

    btnPlay.addEventListener("click", () => {
        overlayContainer.innerHTML = "";

        const overlayEmbed = document.createElement("div");
        overlayEmbed.classList.add("overlay-embed");

        const youtubeId = show.trailer.split("=")[1];

        const videoIframe = `<iframe width="560" height="315" src="https://www.youtube.com/embed/${youtubeId}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`;

        overlayEmbed.innerHTML = videoIframe;

        overlayContainer.appendChild(overlayEmbed);

        // raise the curtain 
        overlayVideo.classList.add("active");
    }); // end of event listener 


    //excerpt
    const showcaseItemExcerpt = document.createElement("p");
    showcaseItemExcerpt.classList.add("showcase-item-excerpt");
    showcaseItemExcerpt.innerText = show.excerpt;

    // mobile control item
    const showcaseControlItem = document.createElement("li");
    showcaseControlItem.addEventListener("click", () => {
        handleSlides(index);
        clearInterval(timer);
        timer = setInterval(handleSlides, 5000);
    }); // end of event listener for showcase control item
    showcaseControls.appendChild(showcaseControlItem);

    //append
    showcaseItemContent.appendChild(showcaseItemLogo);
    showcaseItemContent.appendChild(btnExpand);
    showcaseItemContent.appendChild(btnPlay);
    showcaseItemContent.appendChild(showcaseItemExcerpt);

    showcaseItem.appendChild(showcaseItemContent);
    showcaseItem.appendChild(btnCollapse);
    sectionShowcase.appendChild(showcaseItem);
});// end forEach


const handleSeasons = (seasons, slug) => {
    // initialize an index number 
    let seasonIndex = 0;

    // flush sectionEpisodes
    
    

    // add a container for seasons 
    const seasonContainer = document.createElement("div");
    seasonContainer.classList.add("container");
    
    //display season starts
    const displaySeason = () => {
        // reset the container
        seasonContainer.innerHTML = "";

        // build a header with title and select menu 
        const seasonHeader = document.createElement("div");
        seasonHeader.classList.add("season-header");

        const seasonTitle = document.createElement("h2");
        seasonTitle.innerText = seasons[seasonIndex].title;
        seasonHeader.appendChild(seasonTitle);

        if (seasons.length > 1) {
            const seasonSelect = document.createElement("select");
            seasonSelect.classList.add("season-select");
    
            // add options to the select menu    
            seasons.forEach((season, index) => {
                const seasonOption = document.createElement("option");
                seasonOption.value = index;
                seasonOption.innerText = season.title;
                if (seasonIndex === index) {
                    seasonOption.selected = true;
                }
                seasonSelect.appendChild(seasonOption);
            }); // end of forEach
    
            seasonSelect.addEventListener("change", (event) => {
                //console.log(event);
                seasonIndex = parseInt(event.target.value);
                displaySeason();
            }); // end of event listener
    
            seasonHeader.appendChild(seasonSelect);
        }
        //build a list for episodes 
        const episodesList = document.createElement("div");
        episodesList.classList.add("episodes-list");

        // loop through episodes and build an article for each episodes 
        seasons[seasonIndex].episodes.forEach((episode, index) => {
            const episodeArticle = document.createElement("article");
            episodeArticle.classList.add("episode");

            const episodeImage = document.createElement("img");
            episodeImage.src = `assets/${slug}/seasons/${seasonIndex + 1}/ep${index + 1}.jpg`;
            episodeImage.alt = episode.title;
            episodeArticle.appendChild(episodeImage);

            const episodeText = document.createElement("div");
            episodeText.classList.add("episode-text");
                const episodeTitle = document.createElement("h3");
                episodeTitle.innerText = episode.title;
                episodeText.appendChild(episodeTitle);

                const episodeExcerpt = document.createElement("p");
                episodeExcerpt.innerText = episode.excerpt;
                episodeText.appendChild(episodeExcerpt);

                const episodeDuration = document.createElement("p");
                episodeDuration.classList.add("episode-duration");
                episodeDuration.innerText = `${episode.duration} min.`;
                episodeText.appendChild(episodeDuration);
            
            episodeArticle.appendChild(episodeText);
            episodesList.appendChild(episodeArticle);
        })

        // appending
        seasonContainer.appendChild(seasonHeader);
        seasonContainer.appendChild(episodesList);
        sectionEpisodes.appendChild(seasonContainer);

        // raise the curtain and reveal the seasons box
        sectionEpisodes.classList.add("active");
    }
    displaySeason();
    
} // end of handleSeasons

// console.log(showcaseItems);

let currentSlideIndex = 0;

const showcaseItems = document.querySelectorAll(".showcase-item");
const showcaseControlItems = document.querySelectorAll(".showcase-controls li");

let viewport, windowWidth;

const setViewport = () => {
    windowWidth = window.innerWidth;
    console.log(windowWidth)
    if (windowWidth < 700) {
        viewport = "mobile";
    } else if (windowWidth < 1000) {
        viewport = "tablet";
    } else if (windowWidth < 1200) {
        viewport = "laptop";
    } else {
        viewport = "desktop";
    }
}

window.addEventListener("resize", () => {
    setViewport();
});

setViewport()

const resetSlides = () => {
    showcaseItems.forEach((showcaseItem)=>{
        showcaseItem.classList.remove("visible");
    }); // end of forEach
} // end of reset

const displaySlide = (targetIndex) => {
    showcaseItems[targetIndex].classList.add("visible");
    showcaseControlItems[targetIndex].classList.add("active");
} // end of display slide

const updateSlideIndex = () => {
    if (currentSlideIndex >= showcaseItems.length - 1) {
        currentSlideIndex = 0;
    } else {
        currentSlideIndex++;
    }
} //  end of update slide index

const handleSlides = (clickedIndex) => {
    if (Number.isInteger(clickedIndex)) {
        currentSlideIndex = clickedIndex;
    } 
    // console.log(clickedIndex);
    if (viewport === "mobile" || viewport === "tablet") {
        //reset
        resetSlides();
        // display
        displaySlide(currentSlideIndex);
        // update slide index
        updateSlideIndex();
    }
    

} // end of handleSlides

// initialize immediately
handleSlides();

//setInterval waits for 5 seconds before switching 
let timer = setInterval(handleSlides, 5000);



